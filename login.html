<?php
session_start();

/*
  CTF intent:
  - Username is hidden in ghost.html (view-source)
  - Password is base64 in haunted.js (DevTools)
  - We verify on the server; no direct flag access without session
*/

if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
  http_response_code(405);
  header('Allow: POST');
  echo "<h1 style='color:white;background:black;text-align:center;padding:60px'>Method Not Allowed</h1>";
  exit;
}

// Pull submitted creds
$u = isset($_POST['username']) ? trim($_POST['username']) : '';
$p = isset($_POST['password']) ? trim($_POST['password']) : '';

// The expected values (match the puzzle files)
$EXPECTED_USER = 'ghostbuster24';
$EXPECTED_PASS = 'h4untedh4cker10';

// Compare (exact match for this CTF)
if ($u === $EXPECTED_USER && $p === $EXPECTED_PASS) {
  session_regenerate_id(true);
  $_SESSION['logged_in'] = true;
  $_SESSION['player'] = htmlspecialchars($u, ENT_QUOTES|ENT_HTML5, 'UTF-8');
  header('Location: flag.php');
  exit;
}

http_response_code(401);
echo "<!DOCTYPE html><html><head><meta charset='utf-8'><title>Access Denied</title></head>
<body style='background:black;color:white;text-align:center;padding:80px;font-family:monospace'>
<h1>Access Denied</h1>
<p>The spirits do not recognize you...</p>
<p><a href='login.html' style='color:#ff6347'>Return to login</a></p>
</body></html>";
